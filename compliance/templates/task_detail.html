{% extends "base_generic.html" %}
{% load django_bootstrap5 %}

{% block content %}
<div class="container my-4">
    <div class="container my-5">

        {% include "partials/task_detail_display.html" with task=task status_audit_logs=status_audit_logs %}
        {% include "partials/related_items.html" with related_task_table=related_task_table %}
        <div class="d-flex justify-content-end align-items-center gap-2">
            {% if can_edit %}
            <a href="{% url 'task_edit' task.pk %}" class="btn btn-warning me-2">
                <i class="bi bi-pencil-square"></i> Edit Task
            </a>
            {% endif %}
            {% if task.current_status != "submitted" %}
            <button type="button" class="btn btn-info me-2" data-bs-toggle="modal" data-bs-target="#remarksModal">
                <i class="bi bi-chat-left-text"></i> Add remarks
            </button>
            {% endif %}
            {% if can_mark_as_pending %}

            <button type="button" class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#approvalModal">
                <i class="bi bi-check-circle"></i> Approve
            </button>
            <button type="button" class="btn btn-danger me-2" data-bs-toggle="modal" data-bs-target="#revisionModal">
                <i class="bi bi-arrow-counterclockwise"></i> Revision required
            </button>
            {% endif %}
            {% if can_request_revision %}
            <button type="button" class="btn btn-danger me-2" data-bs-toggle="modal" data-bs-target="#revisionModal">
                <i class="bi bi-arrow-counterclockwise"></i> Revision required
            </button>
            {% endif %}
            {% if can_send_reminder_email %}

            <form method="post" action="{% url 'task_remind' task.pk %}">
                {% csrf_token %}

                <button type="submit" class="btn btn-danger me-2"
                    onclick="return confirm('Send reminder email for this task?');">
                    ðŸ”” Send Reminder
                </button>
            </form>

            {% endif %}
            <a href="{% url 'task_list' filter='overdue' %}" class="btn btn-secondary">
                <i class="bi bi-list"></i> Back to List
            </a>
        </div>
    </div>
</div>

{% url 'task_approve' task.pk as approval_action %}
{% with modal_id="approvalModal" title="Add approval remarks" form=approval_form form_action=approval_action %}
{% include "partials/remarks_modal_form.html" %}
{% endwith %}

{% if can_mark_as_pending %}
{% url 'task_pending' task.pk as revision_action %}
{% elif can_request_revision %}
{% url 'task_revise' task.pk as revision_action %}
{% endif %}

{% with modal_id="revisionModal" title="Revision Required" form=revision_form form_action=revision_action %}
{% include "partials/remarks_modal_form.html" %}
{% endwith %}

{% if task.current_status != "submitted" %}
{% url 'task_remarks' task.pk as remarks_action %}
{% with modal_id="remarksModal" title="Add remarks" form=remarks_form form_action=remarks_action %}
{% include "partials/remarks_modal_form.html" %}
{% endwith %}
{% endif %}

{% endblock content %}
