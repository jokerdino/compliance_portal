{% extends "base_generic.html" %}
{% load django_bootstrap5 %}

{% block content %}

{% include "partials/partial_task_list.html" %}
{% if enable_selection %}
{% include "partials/board_date_modal_form.html" %}
{% endif %}
{% endblock content %}

{% block scripts %}
{{ block.super }}
<script>
    const TASK_STATUS = "{{ status }}";
    const orderColumn = TASK_STATUS === "to_be_approved" ? 6 : 5;
    new DataTable('#taskTable', {
        layout: {
            top1start: 'pageLength',
            topStart: {
                buttons: ['copy', 'csv', 'excel', 'pdf']
            },
        },
        order: [[orderColumn, 'asc']]
    });
</script>

{% if status == "to_be_approved" or enable_selection %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const selectAll = document.getElementById("select-all");

        if (!selectAll) return;

        selectAll.addEventListener("change", function () {
            const checkboxes = document.querySelectorAll(
                "tbody input[type='checkbox']"
            );

            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
            });
        });
    });
</script>
{% endif %}
{% if enable_selection %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById("boardMeetingModal");
        const hiddenInput = document.getElementById("selectedTaskIds");

        if (!modal || !hiddenInput) return;

        modal.addEventListener("show.bs.modal", function (event) {
            const selected = Array.from(
                document.querySelectorAll("tbody input[name='select']:checked")
            ).map(cb => cb.value);

            if (selected.length === 0) {
                alert("Please select at least one task.");
                event.preventDefault();
                return false;
            }

            hiddenInput.value = selected.join(",");
        });
    });
</script>
{% endif %}

{% endblock scripts %}
